---
phase: 29-hook-exploration-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/api/dashboard/hooks/route.ts
autonomous: true

must_haves:
  truths:
    - "GET /api/dashboard/hooks?snapshotId=XXX returns hook groups sorted by totalReach descending"
    - "Unauthorized requests return 401"
    - "Missing or invalid snapshotId returns 400 or 404"
    - "BigInt totalReach is serialized as Number in JSON response"
  artifacts:
    - path: "src/app/api/dashboard/hooks/route.ts"
      provides: "GET endpoint returning hook groups for a snapshot"
      exports: ["GET"]
  key_links:
    - from: "src/app/api/dashboard/hooks/route.ts"
      to: "prisma.hookGroup"
      via: "findMany with orderBy totalReach desc"
      pattern: "prisma\\.hookGroup\\.findMany"
    - from: "src/app/api/dashboard/hooks/route.ts"
      to: "auth()"
      via: "session check"
      pattern: "auth\\(\\)"
---

<objective>
Create the GET /api/dashboard/hooks endpoint that returns hook groups for a given snapshot, sorted by totalReach descending.

Purpose: The UI components (Plan 02) need a data source. This endpoint provides hook group data with proper auth, ownership verification, and BigInt serialization.
Output: A single API route file at src/app/api/dashboard/hooks/route.ts
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-hook-exploration-ui/29-RESEARCH.md

@src/app/api/dashboard/snapshots/route.ts (auth + serialization pattern to follow)
@prisma/schema.prisma (HookGroup model at line 94, BrandSnapshot userId at line 86)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GET /api/dashboard/hooks endpoint</name>
  <files>src/app/api/dashboard/hooks/route.ts</files>
  <action>
Create the file `src/app/api/dashboard/hooks/route.ts` with a single GET handler.

Follow the exact pattern from `src/app/api/dashboard/snapshots/route.ts`:

1. **Auth check**: Call `auth()` from `@/auth`. If no `session?.user?.id`, return 401.

2. **Parse snapshotId**: Extract `snapshotId` from URL searchParams. If missing, return 400 with `{ error: 'Missing snapshotId' }`.

3. **Ownership verification**: Query `prisma.brandSnapshot.findFirst` where `id: snapshotId` AND `userId: session.user.id`. The BrandSnapshot model has a direct `userId` field (line 86 of schema), so ownership check is simple -- no need for OR conditions or nested queries. If not found, return 404.

4. **Fetch hook groups**: Query `prisma.hookGroup.findMany` where `snapshotId`, with `orderBy: { totalReach: 'desc' }`. This uses the existing `@@index([snapshotId, totalReach])` index.

5. **Serialize and return**: Use the same BigInt serialization pattern from the snapshots route (JSON.parse + JSON.stringify with bigint-to-Number replacer). Return `{ hookGroups: serialize(hookGroups) }`.

Import `NextResponse` from `next/server`, `auth` from `@/auth`, `prisma` from `@/lib/prisma`.

Do NOT add POST/PUT/DELETE handlers -- this is read-only.
Do NOT paginate -- hook groups are typically under 100 per snapshot.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors.
Run `npm run build` to confirm the route compiles.
Visually inspect the file to confirm: auth check, snapshotId validation, ownership query, hookGroup findMany with orderBy, BigInt serialization.
  </verify>
  <done>
GET /api/dashboard/hooks?snapshotId=XXX endpoint exists, type-checks, and builds successfully. It returns { hookGroups: [...] } sorted by totalReach descending with BigInt serialized as Number.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- `npm run build` succeeds
- Route file follows same auth/serialization patterns as snapshots/route.ts
</verification>

<success_criteria>
- src/app/api/dashboard/hooks/route.ts exists and exports GET
- Auth check returns 401 for unauthenticated requests
- Missing snapshotId returns 400
- Non-owned snapshot returns 404
- Hook groups returned sorted by totalReach descending
- BigInt totalReach serialized as Number
</success_criteria>

<output>
After completion, create `.planning/phases/29-hook-exploration-ui/29-01-SUMMARY.md`
</output>
