---
phase: 10-auth-foundation
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - src/components/auth/sign-in-button.tsx
  - src/components/auth/sign-out-button.tsx
  - src/components/auth/user-menu.tsx
  - src/app/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can click 'Sign in with Google' and be redirected to Google OAuth"
    - "User can click 'Sign in with GitHub' and be redirected to GitHub OAuth"
    - "Logged-in user sees their name and avatar in the header"
    - "User can click 'Sign out' and be logged out"
  artifacts:
    - path: "src/components/auth/sign-in-button.tsx"
      provides: "OAuth sign-in buttons for Google and GitHub"
      exports: ["SignInButton"]
    - path: "src/components/auth/sign-out-button.tsx"
      provides: "Sign-out button component"
      exports: ["SignOutButton"]
    - path: "src/components/auth/user-menu.tsx"
      provides: "User avatar and dropdown menu"
      exports: ["UserMenu"]
    - path: "src/app/page.tsx"
      provides: "Home page with auth UI in header"
      contains: "UserMenu"
  key_links:
    - from: "src/components/auth/sign-in-button.tsx"
      to: "next-auth/react"
      via: "signIn function"
      pattern: "signIn\\(provider"
    - from: "src/components/auth/user-menu.tsx"
      to: "next-auth/react"
      via: "useSession hook"
      pattern: "useSession\\(\\)"
    - from: "src/app/page.tsx"
      to: "src/components/auth/user-menu.tsx"
      via: "imports and renders"
      pattern: "import.*UserMenu"
---

<objective>
Create auth UI components and integrate them into the application header.

Purpose: Provide visible sign-in/sign-out functionality so users can authenticate with Google or GitHub and see their logged-in state.

Output: Working auth UI with sign-in buttons, user menu, and sign-out capability visible in the page header.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-auth-foundation/10-RESEARCH.md
@.planning/phases/10-auth-foundation/10-01-SUMMARY.md

# Files to modify/reference
@src/app/page.tsx
@src/auth.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create auth UI components</name>
  <files>
    - src/components/auth/sign-in-button.tsx (new)
    - src/components/auth/sign-out-button.tsx (new)
    - src/components/auth/user-menu.tsx (new)
  </files>
  <action>
1. Create `src/components/auth/sign-in-button.tsx`:
   - Mark as "use client"
   - Import signIn from "next-auth/react"
   - Accept provider prop: "google" | "github"
   - On click, call signIn(provider, { redirectTo: "/" })
   - Style with existing Tailwind patterns:
     - Google: white background with Google colors
     - GitHub: dark background (#24292f)
   - Include provider icons (use inline SVG for Google G logo and GitHub octocat)
   - Use the button styling patterns from the existing codebase (rounded-lg, transitions)

2. Create `src/components/auth/sign-out-button.tsx`:
   - Mark as "use client"
   - Import signOut from "next-auth/react"
   - On click, call signOut({ redirectTo: "/" })
   - Style as subtle secondary button matching existing design

3. Create `src/components/auth/user-menu.tsx`:
   - Mark as "use client"
   - Import useSession from "next-auth/react"
   - Import SignOutButton
   - Show loading state when status === "loading"
   - Return null when no session
   - When authenticated, show:
     - User avatar (session.user?.image) with rounded-full styling
     - User name (session.user?.name)
     - SignOutButton
   - Use flex layout with gap-2/gap-3 spacing
   - Style avatar as 32x32px circle with fallback initial if no image

Use patterns from 10-RESEARCH.md Pattern 5 and the User Menu Component example.
  </action>
  <verify>
    - All three component files exist in src/components/auth/
    - Each file has "use client" directive
    - Components compile without TypeScript errors
    - `npm run build` passes
  </verify>
  <done>Auth UI components are created and ready for integration</done>
</task>

<task type="auto">
  <name>Task 2: Integrate auth UI into page header</name>
  <files>
    - src/app/page.tsx (modified)
  </files>
  <action>
1. Modify `src/app/page.tsx` to add auth UI:
   - Import SignInButton from "@/components/auth/sign-in-button"
   - Import UserMenu from "@/components/auth/user-menu"
   - Import useSession from "next-auth/react"

2. Add auth state check in the Home component:
   - Call useSession() to get session and status
   - Use this to conditionally render sign-in buttons or user menu

3. Modify the header section (around line 373-384):
   - Add a wrapper div for auth UI in the header, positioned to the right
   - The header currently has: pill badge, h1 title, description
   - Add auth section with absolute positioning or flex layout:
     - When NOT authenticated: Show SignInButton for Google and GitHub
     - When authenticated: Show UserMenu

4. Header layout should be:
   ```tsx
   <header className="text-center mb-16 animate-fade-in-up relative">
     {/* Auth UI - top right */}
     <div className="absolute top-0 right-0">
       {session ? (
         <UserMenu />
       ) : (
         <div className="flex gap-2">
           <SignInButton provider="google" />
           <SignInButton provider="github" />
         </div>
       )}
     </div>
     {/* Existing header content */}
     <div className="inline-flex items-center ...">...</div>
     <h1>...</h1>
     <p>...</p>
   </header>
   ```

5. Handle loading state:
   - While status === "loading", show a small loading indicator or skeleton

IMPORTANT: The page is already 'use client', so useSession will work directly.
  </action>
  <verify>
    - page.tsx imports auth components
    - page.tsx uses useSession hook
    - Header shows sign-in buttons when logged out
    - Header shows user menu when logged in
    - `npm run build` passes
  </verify>
  <done>Auth UI is visible in the page header</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete OAuth authentication flow with Google and GitHub, including sign-in buttons and user menu in the page header</what-built>
  <how-to-verify>
1. Ensure you have set up OAuth credentials and created `.env.local` with:
   - AUTH_SECRET (run `npx auth secret` to generate)
   - AUTH_GOOGLE_ID and AUTH_GOOGLE_SECRET
   - AUTH_GITHUB_ID and AUTH_GITHUB_SECRET

2. Start the dev server: `npm run dev`

3. Visit http://localhost:3000

4. Verify sign-in buttons visible:
   - [ ] "Sign in with Google" button visible in header (top right)
   - [ ] "Sign in with GitHub" button visible in header (top right)

5. Test Google OAuth:
   - [ ] Click "Sign in with Google"
   - [ ] Redirects to Google login page
   - [ ] After login, redirects back to app
   - [ ] User name and avatar appear in header

6. Test sign-out:
   - [ ] Click "Sign out" in user menu
   - [ ] User is logged out
   - [ ] Sign-in buttons reappear

7. Test GitHub OAuth (sign out first):
   - [ ] Click "Sign in with GitHub"
   - [ ] Redirects to GitHub authorization page
   - [ ] After authorization, redirects back to app
   - [ ] User name and avatar appear in header

8. Test persistence:
   - [ ] Refresh the page while logged in
   - [ ] User remains logged in (session persists)
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Sign-in buttons appear when not logged in
3. User can complete OAuth flow with both Google and GitHub
4. User menu shows name/avatar when logged in
5. Sign-out works and returns to signed-out state
6. Session persists across page refreshes
</verification>

<success_criteria>
- AUTH-01: User can log in with Google OAuth
- AUTH-02: User can log in with GitHub OAuth
- AUTH-03: User can log out from any page
- User sees their logged-in state (name/avatar) in UI
- All auth state changes are reactive (immediate UI updates)
</success_criteria>

<output>
After completion, create `.planning/phases/10-auth-foundation/10-02-SUMMARY.md`
</output>
