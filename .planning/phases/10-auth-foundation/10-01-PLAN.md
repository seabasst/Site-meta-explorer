---
phase: 10-auth-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/auth.ts
  - src/app/api/auth/[...nextauth]/route.ts
  - src/components/providers/session-provider.tsx
  - src/app/layout.tsx
  - .env.local.example
autonomous: true
user_setup:
  - service: google-oauth
    why: "Google OAuth login for users"
    env_vars:
      - name: AUTH_GOOGLE_ID
        source: "Google Cloud Console -> APIs & Services -> Credentials -> OAuth 2.0 Client ID"
      - name: AUTH_GOOGLE_SECRET
        source: "Google Cloud Console -> APIs & Services -> Credentials -> OAuth 2.0 Client Secret"
    dashboard_config:
      - task: "Create OAuth 2.0 Client ID (Web application)"
        location: "Google Cloud Console -> APIs & Services -> Credentials"
      - task: "Add authorized redirect URI: http://localhost:3000/api/auth/callback/google"
        location: "OAuth Client -> Authorized redirect URIs"
  - service: github-oauth
    why: "GitHub OAuth login for users"
    env_vars:
      - name: AUTH_GITHUB_ID
        source: "GitHub Developer Settings -> OAuth Apps -> Client ID"
      - name: AUTH_GITHUB_SECRET
        source: "GitHub Developer Settings -> OAuth Apps -> Client secrets"
    dashboard_config:
      - task: "Create new OAuth App"
        location: "GitHub -> Settings -> Developer settings -> OAuth Apps"
      - task: "Set Homepage URL: http://localhost:3000"
        location: "OAuth App settings"
      - task: "Set Authorization callback URL: http://localhost:3000/api/auth/callback/github"
        location: "OAuth App settings"
  - service: auth-secret
    why: "JWT encryption secret for Auth.js"
    env_vars:
      - name: AUTH_SECRET
        source: "Generate with: npx auth secret"

must_haves:
  truths:
    - "Auth.js is configured with Google and GitHub providers"
    - "OAuth callbacks are handled at /api/auth/*"
    - "Session is available in both Server and Client Components"
  artifacts:
    - path: "src/auth.ts"
      provides: "Auth.js configuration with Google/GitHub providers"
      exports: ["handlers", "auth", "signIn", "signOut"]
    - path: "src/app/api/auth/[...nextauth]/route.ts"
      provides: "OAuth callback route handler"
      exports: ["GET", "POST"]
    - path: "src/components/providers/session-provider.tsx"
      provides: "Client-side SessionProvider wrapper"
      exports: ["SessionProvider"]
    - path: "src/app/layout.tsx"
      provides: "Root layout wrapped with SessionProvider"
      contains: "SessionProvider"
    - path: ".env.local.example"
      provides: "Template for required environment variables"
      contains: "AUTH_SECRET"
  key_links:
    - from: "src/app/api/auth/[...nextauth]/route.ts"
      to: "src/auth.ts"
      via: "imports handlers"
      pattern: "import.*handlers.*from.*@/auth"
    - from: "src/app/layout.tsx"
      to: "src/components/providers/session-provider.tsx"
      via: "wraps children with SessionProvider"
      pattern: "<SessionProvider>"
---

<objective>
Set up Auth.js v5 infrastructure with Google and GitHub OAuth providers.

Purpose: Enable OAuth authentication flow for the application. This plan establishes the foundation that auth UI components will build upon.

Output: Working Auth.js configuration with OAuth providers, route handlers, and SessionProvider integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-auth-foundation/10-RESEARCH.md

# Existing files to modify
@src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Auth.js and create auth configuration</name>
  <files>
    - package.json (modified via npm)
    - src/auth.ts (new)
    - src/app/api/auth/[...nextauth]/route.ts (new)
    - .env.local.example (new)
  </files>
  <action>
1. Install Auth.js v5:
   ```bash
   npm install next-auth@beta
   ```

2. Create `src/auth.ts` with the following configuration:
   - Import NextAuth and providers (Google, GitHub)
   - Use JWT session strategy (no database needed for Phase 10)
   - Add type augmentation to extend Session with user.id
   - Configure callbacks to pass user.id from JWT to session
   - Export: handlers, auth, signIn, signOut

3. Create `src/app/api/auth/[...nextauth]/route.ts`:
   - Import handlers from @/auth
   - Export GET and POST handlers

4. Create `.env.local.example` with template:
   ```
   # Auth.js - Generate with: npx auth secret
   AUTH_SECRET=

   # Google OAuth - https://console.cloud.google.com/apis/credentials
   AUTH_GOOGLE_ID=
   AUTH_GOOGLE_SECRET=

   # GitHub OAuth - https://github.com/settings/developers
   AUTH_GITHUB_ID=
   AUTH_GITHUB_SECRET=
   ```

Use the exact patterns from 10-RESEARCH.md Pattern 1 and Pattern 2.
  </action>
  <verify>
    - `npm ls next-auth` shows next-auth@5.x installed
    - `src/auth.ts` exists and exports handlers, auth, signIn, signOut
    - `src/app/api/auth/[...nextauth]/route.ts` exists and exports GET, POST
    - `.env.local.example` exists with all required env var placeholders
  </verify>
  <done>Auth.js is installed and configured with Google/GitHub providers using JWT strategy</done>
</task>

<task type="auto">
  <name>Task 2: Create SessionProvider and integrate into layout</name>
  <files>
    - src/components/providers/session-provider.tsx (new)
    - src/app/layout.tsx (modified)
  </files>
  <action>
1. Create `src/components/providers/session-provider.tsx`:
   - Mark as "use client"
   - Import SessionProvider from "next-auth/react" (rename to NextAuthSessionProvider)
   - Export a SessionProvider component that wraps children
   - Use the exact pattern from 10-RESEARCH.md Pattern 4

2. Modify `src/app/layout.tsx`:
   - Import SessionProvider from "@/components/providers/session-provider"
   - Wrap the {children} inside <body> with <SessionProvider>
   - Keep all existing functionality (fonts, Toaster, Google Analytics)
   - The structure should be:
     ```tsx
     <body>
       <SessionProvider>
         {children}
         <Toaster ... />
       </SessionProvider>
     </body>
     ```

IMPORTANT: Do NOT import or use SessionProvider from next-auth/react directly in layout.tsx (it's a Server Component). Use the client wrapper component.
  </action>
  <verify>
    - `src/components/providers/session-provider.tsx` exists with "use client" directive
    - `src/app/layout.tsx` imports and uses SessionProvider
    - `npm run build` completes without errors
  </verify>
  <done>SessionProvider wraps the application, enabling useSession hook in client components</done>
</task>

</tasks>

<verification>
1. Run `npm run build` - should complete without errors
2. Run `npm run dev` and visit http://localhost:3000/api/auth/providers - should return JSON with google and github providers (will show error about missing env vars, which is expected until user configures OAuth)
3. Check that layout.tsx properly wraps children with SessionProvider
</verification>

<success_criteria>
- Auth.js v5 (next-auth@beta) is installed
- src/auth.ts exports handlers, auth, signIn, signOut
- Route handler exists at src/app/api/auth/[...nextauth]/route.ts
- SessionProvider wrapper exists and is used in layout.tsx
- .env.local.example documents all required environment variables
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-auth-foundation/10-01-SUMMARY.md`
</output>
