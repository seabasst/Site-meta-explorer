---
phase: 15-chart-improvements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/demographics/media-type-chart.tsx
  - src/components/analytics/time-trends.tsx
autonomous: true

must_haves:
  truths:
    - "Hovering over a bar in MediaTypeChart shows a rich tooltip with count, percentage, and color dot"
    - "Hovering over a data point in TimeTrends weekly chart shows a rich tooltip with week label, ad count, and total reach context"
    - "No console warnings about ResponsiveContainer width/height"
    - "Charts resize properly when window is resized"
  artifacts:
    - path: "src/components/demographics/media-type-chart.tsx"
      provides: "Rich custom tooltip for media type bar chart + fixed ResponsiveContainer"
      contains: "RichTooltip|MediaTypeTooltip"
    - path: "src/components/analytics/time-trends.tsx"
      provides: "Rich custom tooltip for weekly line chart + proper ResponsiveContainer sizing"
      contains: "WeeklyTooltip|TimeTrendsTooltip"
  key_links:
    - from: "src/components/demographics/media-type-chart.tsx"
      to: "Recharts Tooltip"
      via: "content prop with render function"
      pattern: "content=.*props.*=>"
    - from: "src/components/analytics/time-trends.tsx"
      to: "Recharts Tooltip"
      via: "content prop with render function"
      pattern: "content=.*props.*=>"
---

<objective>
Add rich custom tooltips to Recharts-based charts and fix ResponsiveContainer sizing.

Purpose: Satisfy CHRT-01 (rich tooltips) and CHRT-02 (responsive sizing) for Recharts charts. The current MediaTypeChart uses a basic formatter function for tooltips, and TimeTrends uses inline contentStyle. Both need proper custom tooltip components matching the app's dark theme. ResponsiveContainer parent divs need explicit Tailwind height classes instead of inline styles.

Output: Enhanced MediaTypeChart and TimeTrends with rich, themed tooltips and proper responsive containers.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-chart-improvements/15-RESEARCH.md

Key files to read before implementing:
@src/components/demographics/media-type-chart.tsx
@src/components/analytics/time-trends.tsx
@src/components/ui/chart.tsx (for ChartTooltipContent pattern reference)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rich tooltip and ResponsiveContainer fix for MediaTypeChart</name>
  <files>src/components/demographics/media-type-chart.tsx</files>
  <action>
  1. Create a custom tooltip component `MediaTypeTooltip` inside the file (not exported). It receives Recharts TooltipProps and renders:
     - A themed container: `rounded-lg border bg-[var(--bg-secondary)] border-[var(--border-subtle)] px-3 py-2 shadow-md`
     - Color dot (3x3 rounded-full) with the entry's color
     - Media type name in bold
     - Count and percentage on a second line: "{count} ads ({percentage}%)"
     - Use `payload[0].payload` to access the original data item (which has name, count, percentage, color)

  2. Replace the current `<Tooltip formatter={...} />` with:
     ```
     <Tooltip content={(props) => <MediaTypeTooltip {...props} />} />
     ```
     Use the Recharts v3 render function pattern (NOT JSX element pattern).

  3. Fix ResponsiveContainer: Change the parent div from `<div style={{ width: '100%', height: 150 }}>` to `<div className="w-full h-[150px]">`. Ensure ResponsiveContainer has `width="100%" height="100%"` props.

  4. Also fix the empty state div: change `<div style={{ width: '100%', height: 200 }}>` to `<div className="w-full h-[200px]">`.

  Import TooltipProps type:
  ```typescript
  import type { TooltipProps } from 'recharts';
  import type { NameType, ValueType } from 'recharts/types/component/DefaultTooltipContent';
  ```

  Use CSS variables for theming (var(--bg-secondary), var(--border-subtle), var(--text-primary), var(--text-muted)) to match the dark theme.
  </action>
  <verify>
  Run `npx next build` to confirm no TypeScript errors. Visually verify by running `npm run dev` and hovering over MediaTypeChart bars -- tooltip should show themed popup with color dot, media type name, count and percentage.
  </verify>
  <done>MediaTypeChart shows a rich themed tooltip on hover with color dot, name, count, and percentage. Parent div uses Tailwind classes instead of inline styles. No ResponsiveContainer console warnings.</done>
</task>

<task type="auto">
  <name>Task 2: Rich tooltip and ResponsiveContainer fix for TimeTrends</name>
  <files>src/components/analytics/time-trends.tsx</files>
  <action>
  1. Create a custom tooltip component `WeeklyTooltip` inside the file (not exported). It receives Recharts TooltipProps and renders:
     - A themed container matching the app's dark theme: `rounded-lg border bg-[var(--bg-secondary)] border-[var(--border-subtle)] px-3 py-2 shadow-md`
     - Week label as the header (bold, text-primary)
     - A line showing: green dot + "{count} ads launched"
     - The tooltip should gracefully handle null/empty payload

  2. Replace the current `<Tooltip contentStyle={...} formatter={...} labelStyle={...} />` with:
     ```
     <Tooltip content={(props) => <WeeklyTooltip {...props} />} />
     ```
     Use the Recharts v3 render function pattern.

  3. The weekly chart container already has `<div className="h-[200px] w-full">` which is correct. Verify ResponsiveContainer has explicit `width="100%" height="100%"` props -- add them if missing.

  Import TooltipProps type:
  ```typescript
  import type { TooltipProps } from 'recharts';
  import type { NameType, ValueType } from 'recharts/types/component/DefaultTooltipContent';
  ```

  Use CSS variables for theming to match the existing dark theme.
  </action>
  <verify>
  Run `npx next build` to confirm no TypeScript errors. Visually verify by running `npm run dev`, analyzing a brand, going to "Ad Overview" tab, and hovering over weekly chart data points -- tooltip should show themed popup with week label and ad count.
  </verify>
  <done>TimeTrends weekly chart shows a rich themed tooltip on hover with week label and ad count. Tooltip uses CSS variables for consistent dark theme styling.</done>
</task>

</tasks>

<verification>
1. `npx next build` completes without errors
2. Both charts render correctly with data
3. Hovering shows rich tooltips with proper theming (dark background, correct colors)
4. No console warnings about ResponsiveContainer dimensions
5. Charts resize properly when browser window is resized
</verification>

<success_criteria>
- MediaTypeChart tooltip shows color dot, media type name, count, and percentage in themed container
- TimeTrends weekly chart tooltip shows week label and ad count in themed container
- No inline style dimensions on chart containers (uses Tailwind classes)
- No console warnings related to ResponsiveContainer
- Build passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/15-chart-improvements/15-01-SUMMARY.md`
</output>
