---
phase: 14-ad-preview
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ads/ad-preview-card.tsx
autonomous: true

must_haves:
  truths:
    - "User can click any ad preview card to open the ad on Facebook"
    - "User can read the full creative body text without truncation"
    - "User can see a Video or Image badge on ads where media type is resolved"
  artifacts:
    - path: "src/components/ads/ad-preview-card.tsx"
      provides: "Ad preview card with working media badges and full creative text"
      contains: "badgeType"
  key_links:
    - from: "src/components/ads/ad-preview-card.tsx"
      to: "useAdMedia hook"
      via: "resolvedMediaType used for badge display"
      pattern: "resolvedMediaType.*video|resolvedMediaType.*image"
---

<objective>
Fix the two gaps in the AdPreviewCard component: media type badges that never show (because ad.mediaType is always 'unknown') and creative body text that is truncated against the Phase 6 decision.

Purpose: Satisfy all three Phase 14 success criteria (PREV-01 already done, PREV-02 and PREV-03 need fixes).
Output: Updated AdPreviewCard with working video/image badges and full creative text display.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-ad-preview/14-RESEARCH.md
@src/components/ads/ad-preview-card.tsx
@src/hooks/use-ad-media.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix media type badge and remove creative text truncation</name>
  <files>src/components/ads/ad-preview-card.tsx</files>
  <action>
Two targeted changes in ad-preview-card.tsx:

**1. Media type badge (lines 128-136) -- use resolvedMediaType instead of ad.mediaType:**

Derive a `badgeType` variable from `resolvedMediaType` (already returned by `useAdMedia` on line 27-30):

```typescript
const badgeType = resolvedMediaType === 'video' ? 'video'
  : resolvedMediaType === 'image' ? 'image'
  : ad.mediaType !== 'unknown' ? ad.mediaType
  : null;
```

Place this after the `useAdMedia` call. Then replace the badge JSX block (lines 128-136):

```tsx
{badgeType && (
  <span className={`px-2 py-0.5 rounded text-xs font-medium backdrop-blur-sm ${
    badgeType === 'video'
      ? 'bg-purple-500/20 text-purple-400'
      : 'bg-blue-500/20 text-blue-400'
  }`}>
    {badgeType === 'video' ? 'Video' : 'Image'}
  </span>
)}
```

Note: 'snapshot' type (Vercel fallback) will correctly result in `badgeType = null`, so no badge shows when type cannot be determined. This is the intended behavior per the research.

Also update the fallback placeholder section (lines 100-112) to use `badgeType` for the icon/text, replacing `ad.mediaType` references:
- `ad.mediaType === 'video'` becomes `badgeType === 'video'`
- `View ${ad.mediaType === 'video' ? 'video' : 'ad'}` becomes `View ${badgeType === 'video' ? 'video' : 'ad'}`

**2. Creative body text (line 156) -- remove line-clamp-2:**

Change:
```tsx
<p className="text-xs text-[var(--text-secondary)] line-clamp-2">
```
To:
```tsx
<p className="text-xs text-[var(--text-secondary)]">
```

Keep `line-clamp-2` on the `linkTitle` (line 149) -- titles are short and truncation is reasonable there.

Do NOT modify any other files. The existing data flow, hooks, and API layer are all correct.
  </action>
  <verify>
Run `npx next build` to confirm no TypeScript or build errors.

Manual verification:
- The `badgeType` variable is derived from `resolvedMediaType`
- The badge JSX uses `badgeType` (not `ad.mediaType`)
- `line-clamp-2` is removed from creativeBody paragraph
- `line-clamp-2` is still present on linkTitle
- No other files were modified
  </verify>
  <done>
- Media type badge shows "Video" (purple) or "Image" (blue) when useAdMedia resolves the type
- Badge does not show for 'snapshot' or 'unknown' types (graceful fallback)
- Creative body text displays in full without truncation
- Link title still truncates at 2 lines
- Click-to-view on Facebook still works (unchanged)
  </done>
</task>

</tasks>

<verification>
All three Phase 14 success criteria met:
1. PREV-01: User can click to view ad on Facebook (already working, unchanged)
2. PREV-02: User can see ad creative text in results (line-clamp-2 removed from body)
3. PREV-03: User can distinguish video ads from image ads (badge uses resolvedMediaType)
</verification>

<success_criteria>
- AdPreviewCard shows Video/Image badges based on resolved media type
- Creative body text is fully visible (no truncation)
- Build passes with no errors
- No regressions to existing functionality (click-to-view, media loading, reach badge)
</success_criteria>

<output>
After completion, create `.planning/phases/14-ad-preview/14-01-SUMMARY.md`
</output>
