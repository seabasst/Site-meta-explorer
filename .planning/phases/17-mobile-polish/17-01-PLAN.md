---
phase: 17-mobile-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/page.tsx
autonomous: true

must_haves:
  truths:
    - "Options bar wraps cleanly on 375px screens without horizontal overflow"
    - "Media type breakdown stacks vertically on mobile"
    - "All-ads table scrolls horizontally on mobile without page overflow"
    - "Tab navigation does not overflow on small screens"
    - "Export dropdown opens on tap (not hover-only)"
    - "ActiveChartFilter close button has 48px touch target"
    - "Example brand pills have 48px touch targets"
  artifacts:
    - path: "src/app/page.tsx"
      provides: "Responsive main page layout"
      contains: "flex-col sm:flex-row"
  key_links:
    - from: "src/app/page.tsx options bar"
      to: "mobile layout"
      via: "Tailwind responsive classes"
      pattern: "hidden sm:block"
---

<objective>
Make the main page (page.tsx) fully responsive and touch-friendly on mobile devices.

Purpose: The main page contains the options bar, media type breakdown, all-ads table, tab navigation, export dropdown, and various interactive elements that currently break or are unusable on mobile viewports (375px+). This plan fixes all mobile issues within page.tsx.

Output: A responsive page.tsx where all sections adapt to mobile screens, touch targets meet 48px minimum, and hover-only interactions have tap alternatives.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/17-mobile-polish/17-RESEARCH.md
@src/app/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix layout overflow and touch targets in page.tsx</name>
  <files>src/app/page.tsx</files>
  <action>
Make the following responsive and touch-target fixes in src/app/page.tsx:

1. **Options bar (~L606-705):** Hide the vertical divider elements (`w-px h-6 bg-[var(--border-subtle)]`) on mobile by adding `hidden sm:block` class. The flex-wrap is already present but dividers look broken when wrapped. Group the date range inputs to stack on mobile: wrap the date inputs section in a `flex flex-wrap items-center gap-2` container. Ensure the overall options div works well when items wrap to multiple lines.

2. **Media type breakdown (~L1303-1384):** Change the outer container from `flex items-center gap-8` to `flex flex-col sm:flex-row items-stretch sm:items-center gap-3 sm:gap-8`. Change the divider from `h-12 w-px` to `h-px w-full sm:h-12 sm:w-px` so it becomes horizontal on mobile. Apply the same pattern to the unknown media type divider. Ensure the buttons have `min-h-[48px]` for touch targets.

3. **All-ads table (~L1486-1553):** Wrap the table container div (the one with `max-h-[400px] overflow-y-auto`) with an outer div that has `overflow-x-auto`. Add `min-w-[640px]` to the table element so it scrolls horizontally on mobile instead of squishing columns.

4. **Tab navigation (~L1067-1107):** Change the tab container from `w-fit` to `w-fit max-w-full overflow-x-auto`. This allows horizontal scrolling if tabs overflow on very narrow screens. Alternatively, on small screens, hide the SVG icons in tabs by adding `hidden sm:block` to the svg elements, and reduce padding from `px-4` to `px-3 sm:px-4` to save space.

5. **ActiveChartFilter close button (~L52-64):** Change the close button from `p-0.5` to `p-2.5 -m-2` to expand the touch target to 48px while keeping the visual size the same. The X icon stays at `w-3.5 h-3.5` but the hit area is larger (14px icon + 2*10px padding = 34px visible, but the padded hit area reaches 48px).

6. **Example brand pills (~L711-731):** Add `min-h-[48px]` to the button className and change padding from `py-1.5` to `py-3` to ensure 48px touch targets on mobile.
  </action>
  <verify>
Run `npx next build` to confirm no build errors. Visually inspect the page at 375px viewport width in browser DevTools to confirm:
- Options bar wraps without horizontal page overflow
- Media type section stacks vertically
- All-ads table scrolls horizontally
- Tab navigation fits or scrolls
- Close button on chart filter has expanded hit area (~48px)
- Brand pills have adequate height (~48px)
  </verify>
  <done>
All page.tsx layout sections adapt to 375px mobile viewport without horizontal page overflow. All interactive elements have minimum 48px touch targets.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add tap-to-toggle for export dropdown</name>
  <files>src/app/page.tsx</files>
  <action>
The export dropdown (~L932-997) currently uses `group-hover:opacity-100 group-hover:visible` which is hover-only and does not work on touch devices. Add click-to-toggle behavior:

1. Add an `exportOpen` boolean state variable using `useState(false)` near the other state declarations at the top of the component.

2. On the export dropdown trigger button, add an `onClick` handler that toggles `exportOpen`: `setExportOpen(prev => !prev)`.

3. Show the dropdown when `exportOpen` is true OR on group-hover. Modify the dropdown div's className: keep the existing `group-hover:opacity-100 group-hover:visible` classes, but also conditionally add `opacity-100 visible` when `exportOpen` is true. Example: `${exportOpen ? 'opacity-100 visible' : 'opacity-0 invisible'} group-hover:opacity-100 group-hover:visible`.

4. Add a `useEffect` to close the dropdown when clicking outside. Use a ref on the export dropdown container. In the effect, add a `mousedown` event listener on `document` that checks if the click target is outside the ref, and if so calls `setExportOpen(false)`. Clean up the listener on unmount.

5. Add `onClick` handlers to each export dropdown item (PDF, CSV, etc.) that call `setExportOpen(false)` after triggering their export action, so the dropdown closes after selection.

6. Ensure the export trigger button itself has `min-h-[48px]` for touch target compliance.

Keep the hover behavior for desktop -- it still works on desktop via the group-hover classes.
  </action>
  <verify>
Run `npx next build` to confirm no build errors. Test at 375px viewport:
- Clicking/tapping the export button opens the dropdown
- Clicking/tapping an export option triggers the export and closes the dropdown
- Clicking outside the dropdown closes it
- On desktop, hover still opens the dropdown
  </verify>
  <done>
Export dropdown opens on tap for touch devices. Dropdown closes on outside click and after item selection. Hover behavior preserved for desktop. Export button has 48px touch target.
  </done>
</task>

</tasks>

<verification>
- No horizontal page overflow at 375px viewport width
- All interactive elements have minimum 48px touch targets
- Export dropdown opens on tap (not hover-only)
- `npx next build` succeeds without errors
</verification>

<success_criteria>
- page.tsx renders without horizontal overflow at 375px width
- Options bar wraps cleanly with hidden dividers on mobile
- Media type section stacks vertically on mobile
- All-ads table has horizontal scroll on mobile
- Tab navigation fits or scrolls on narrow screens
- Export dropdown is tap-accessible
- All touch targets meet 48px minimum
</success_criteria>

<output>
After completion, create `.planning/phases/17-mobile-polish/17-01-SUMMARY.md`
</output>
