---
phase: 05-error-handling-foundation
plan: 03
type: execute
wave: 2
depends_on: [05-01]
files_modified:
  - src/components/loading/demographics-skeleton.tsx
  - src/components/loading/chart-skeleton.tsx
  - src/components/loading/results-skeleton.tsx
  - src/app/layout.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User sees skeleton placeholders matching actual content dimensions while loading"
    - "Toaster component is mounted and ready for toast notifications"
  artifacts:
    - path: "src/components/loading/demographics-skeleton.tsx"
      provides: "Skeleton for demographics summary section"
      exports: ["DemographicsSkeleton"]
    - path: "src/components/loading/chart-skeleton.tsx"
      provides: "Skeleton for chart areas"
      exports: ["ChartSkeleton"]
    - path: "src/components/loading/results-skeleton.tsx"
      provides: "Full loading skeleton for results area"
      exports: ["ResultsSkeleton"]
    - path: "src/app/layout.tsx"
      provides: "Root layout with Toaster mounted"
      contains: "<Toaster"
  key_links:
    - from: "src/components/ui/skeleton.tsx"
      to: "src/components/loading/*"
      via: "Skeleton component import"
      pattern: "from.*ui/skeleton"
    - from: "src/components/ui/sonner.tsx"
      to: "src/app/layout.tsx"
      via: "Toaster import"
      pattern: "from.*ui/sonner"
---

<objective>
Create skeleton loading components that match the dimensions of real content (demographics, charts, results) and integrate the Toaster component into the root layout for toast notifications.

Purpose: Provides skeleton UI that reduces perceived loading time and prevents layout shift (UIUX-01). Mounts Toaster for later use with API error toasts (ERRH-02).

Output: Skeleton components in src/components/loading/, Toaster in layout.tsx
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-error-handling-foundation/05-RESEARCH.md
@.planning/phases/05-error-handling-foundation/05-01-SUMMARY.md
@src/app/layout.tsx
@src/app/page.tsx
@src/components/demographics/demographics-summary.tsx
@src/components/demographics/age-gender-chart.tsx
@src/components/demographics/country-chart.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create skeleton loading components</name>
  <files>
    - src/components/loading/demographics-skeleton.tsx
    - src/components/loading/chart-skeleton.tsx
    - src/components/loading/results-skeleton.tsx
  </files>
  <action>
    Create src/components/loading/ directory.

    Create src/components/loading/demographics-skeleton.tsx:

    ```typescript
    import { Skeleton } from '@/components/ui/skeleton';

    /**
     * Skeleton for the demographics summary section.
     * Matches DemographicsSummary component dimensions.
     */
    export function DemographicsSkeleton() {
      return (
        <div className="glass rounded-xl p-5 space-y-4">
          {/* Header skeleton */}
          <div className="flex items-center justify-between">
            <Skeleton className="h-5 w-32" />
            <Skeleton className="h-4 w-24" />
          </div>

          {/* Stats grid - matches 3-column summary layout */}
          <div className="grid grid-cols-3 gap-4">
            {[1, 2, 3].map((i) => (
              <div key={i} className="space-y-2">
                <Skeleton className="h-8 w-20" />
                <Skeleton className="h-4 w-28" />
              </div>
            ))}
          </div>

          {/* Insight text skeleton */}
          <div className="space-y-2 pt-2">
            <Skeleton className="h-4 w-full" />
            <Skeleton className="h-4 w-3/4" />
          </div>
        </div>
      );
    }
    ```

    Create src/components/loading/chart-skeleton.tsx:

    ```typescript
    import { Skeleton } from '@/components/ui/skeleton';

    interface ChartSkeletonProps {
      height?: number;
      showLegend?: boolean;
    }

    /**
     * Skeleton for chart areas.
     * Height defaults to 200px to match AgeGenderChart and CountryChart.
     */
    export function ChartSkeleton({ height = 200, showLegend = true }: ChartSkeletonProps) {
      return (
        <div className="glass rounded-xl p-5 space-y-4">
          {/* Chart title skeleton */}
          <div className="flex items-center justify-between">
            <Skeleton className="h-5 w-40" />
          </div>

          {/* Chart area skeleton */}
          <Skeleton className={`w-full rounded-xl`} style={{ height: `${height}px` }} />

          {/* Legend skeleton */}
          {showLegend && (
            <div className="flex justify-center gap-6">
              {[1, 2, 3].map((i) => (
                <div key={i} className="flex items-center gap-2">
                  <Skeleton className="h-3 w-3 rounded-full" />
                  <Skeleton className="h-3 w-16" />
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }
    ```

    Create src/components/loading/results-skeleton.tsx:

    ```typescript
    import { Skeleton } from '@/components/ui/skeleton';
    import { DemographicsSkeleton } from './demographics-skeleton';
    import { ChartSkeleton } from './chart-skeleton';

    /**
     * Full skeleton for the results area while API is loading.
     * Matches the complete results section layout in page.tsx.
     */
    export function ResultsSkeleton() {
      return (
        <div className="animate-fade-in mb-8">
          <div className="glass rounded-2xl p-6">
            {/* Header with stats */}
            <div className="flex items-start justify-between gap-4 mb-4">
              <div>
                <Skeleton className="h-7 w-64 mb-2" />
                <Skeleton className="h-4 w-80" />
              </div>
              <div className="flex items-center gap-4">
                <div className="text-right">
                  <Skeleton className="h-8 w-24 mb-1" />
                  <Skeleton className="h-3 w-16" />
                </div>
                <div className="text-right">
                  <Skeleton className="h-8 w-16 mb-1" />
                  <Skeleton className="h-3 w-20" />
                </div>
              </div>
            </div>

            {/* Loading indicator */}
            <div className="mt-4 text-center py-8">
              <div className="inline-flex flex-col items-center gap-3">
                <div className="w-6 h-6 rounded-full border-[3px] border-[var(--border-medium)] border-t-[var(--accent-green-light)] animate-spin" />
                <div className="text-center">
                  <Skeleton className="h-5 w-32 mx-auto mb-1" />
                  <Skeleton className="h-4 w-48 mx-auto" />
                </div>
              </div>
            </div>

            {/* Demographics skeleton */}
            <div className="mt-6 space-y-6">
              <div className="flex items-center justify-between">
                <Skeleton className="h-6 w-48" />
                <Skeleton className="h-4 w-32" />
              </div>
              <DemographicsSkeleton />

              {/* Charts skeleton */}
              <div className="space-y-4">
                <ChartSkeleton height={200} />
                <ChartSkeleton height={200} showLegend={false} />
              </div>
            </div>
          </div>
        </div>
      );
    }
    ```

    Note: Skeletons use existing CSS variables (--border-medium, --accent-green-light) to match app styling.
  </action>
  <verify>
    - `ls src/components/loading/` shows demographics-skeleton.tsx, chart-skeleton.tsx, results-skeleton.tsx
    - `npx tsc --noEmit` passes
    - Components import Skeleton from @/components/ui/skeleton
  </verify>
  <done>
    - DemographicsSkeleton matches demographics-summary layout
    - ChartSkeleton matches chart component dimensions (200px default)
    - ResultsSkeleton combines all skeletons for full loading state
    - All skeletons use app's CSS variables for consistent styling
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Toaster to root layout</name>
  <files>
    - src/app/layout.tsx
  </files>
  <action>
    Modify src/app/layout.tsx to add the Toaster component from Sonner.

    1. Add import at top:
       ```typescript
       import { Toaster } from '@/components/ui/sonner';
       ```

    2. Add Toaster inside body, after {children}:
       ```tsx
       <body className={`${geistSans.variable} ${geistMono.variable} antialiased`}>
         {children}
         <Toaster position="top-right" richColors />
       </body>
       ```

    The `position="top-right"` places toasts in upper right corner.
    The `richColors` prop enables styled success/error/warning variants.

    Note: Do NOT wrap in 'use client' - Toaster is a client component and will work correctly when imported into the server layout.
  </action>
  <verify>
    - `cat src/app/layout.tsx | grep Toaster` shows Toaster import and usage
    - `npm run build` succeeds
    - Start dev server and verify no hydration errors
  </verify>
  <done>
    - Toaster imported from @/components/ui/sonner
    - Toaster mounted in layout.tsx body
    - Position set to top-right
    - richColors enabled for error/success styling
  </done>
</task>

</tasks>

<verification>
1. TypeScript check: `npx tsc --noEmit` passes
2. Build check: `npm run build` succeeds
3. All skeleton files exist in src/components/loading/
4. Toaster present in layout.tsx
5. Dev server starts without hydration errors
</verification>

<success_criteria>
- Skeleton components exist and match real content dimensions (UIUX-01)
- No layout shift when real content loads (skeletons same size as content)
- Toaster mounted in layout and ready for toast.error() calls (prep for ERRH-02)
- Build succeeds with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-error-handling-foundation/05-03-SUMMARY.md`
</output>
