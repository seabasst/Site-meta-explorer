---
phase: 13-pro-features
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/tier/feature-gate.tsx
  - src/app/page.tsx
autonomous: true

must_haves:
  truths:
    - "Pro user sees full ad preview grid with 6 top ads"
    - "Free user sees blurred/locked ad preview section with upgrade CTA"
    - "Clicking upgrade CTA triggers checkout for logged-in users"
    - "Clicking upgrade CTA triggers sign-in for anonymous users"
  artifacts:
    - path: "src/components/tier/feature-gate.tsx"
      provides: "Reusable feature gating wrapper component"
      exports: ["FeatureGate"]
    - path: "src/app/page.tsx"
      provides: "Ad preview grid wrapped with FeatureGate"
      contains: "FeatureGate.*adPreviews"
  key_links:
    - from: "src/components/tier/feature-gate.tsx"
      to: "src/hooks/use-tier-access.ts"
      via: "useTierAccess hook"
      pattern: "useTierAccess\\(\\)"
    - from: "src/components/tier/feature-gate.tsx"
      to: "src/app/actions/stripe.ts"
      via: "createCheckoutSession action"
      pattern: "createCheckoutSession"
---

<objective>
Create a reusable FeatureGate component and apply it to gate ad preview visibility by tier.

Purpose: Implements TIER-03 (Pro users see ad previews, free users see locked teaser).
Output: FeatureGate component + ad preview section gated in page.tsx.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-pro-features/13-RESEARCH.md

@src/lib/tiers.ts
@src/hooks/use-tier-access.ts
@src/components/tier/depth-selector.tsx
@src/components/tier/pro-badge.tsx
@src/components/ads/ad-preview-card.tsx
@src/app/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FeatureGate component</name>
  <files>src/components/tier/feature-gate.tsx</files>
  <action>
Create a reusable FeatureGate component that wraps Pro-only content.

Pattern to follow (from DepthSelector):
- Use `useTierAccess()` to get `config.features[feature]` and `isLoading`
- Use `useSession()` and `signIn()` from next-auth/react
- Use `useTransition()` with `createCheckoutSession` for checkout flow
- Use `ProBadge` from './pro-badge'

Component props:
- `feature`: 'deepAnalysis' | 'export' | 'adPreviews' (keyof TierConfig['features'])
- `children`: React.ReactNode (the Pro content)
- `fallback?`: React.ReactNode (optional loading fallback)
- `showTeaser?`: boolean (default true - show blurred teaser vs hide completely)

Behavior:
1. If `isLoading` - show fallback (or pulsing skeleton div)
2. If `config.features[feature]` is true - render children as-is
3. If feature locked and `showTeaser` is false - return null
4. If feature locked and `showTeaser` is true:
   - Show children with `opacity-50 pointer-events-none blur-sm` classes
   - Overlay with lock icon, "Pro Feature" text, ProBadge, and "Upgrade to Pro" button
   - Button triggers `signIn()` if no session, else `createCheckoutSession()`

Use CSS variables for styling (var(--bg-primary), var(--text-primary), etc).
Use Lock icon from lucide-react.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Component exports correctly: `grep "export function FeatureGate" src/components/tier/feature-gate.tsx`
  </verify>
  <done>
FeatureGate component exists with correct props and tier-checking logic.
  </done>
</task>

<task type="auto">
  <name>Task 2: Gate ad preview section in page.tsx</name>
  <files>src/app/page.tsx</files>
  <action>
Wrap the "Top Ads by Reach" section with FeatureGate component.

Location in page.tsx (around line 700-717):
The section starts with `<p className="mb-2 font-medium...">Top Ads by Reach</p>`
and contains the grid of AdPreviewCard components.

Changes needed:
1. Import FeatureGate: `import { FeatureGate } from '@/components/tier/feature-gate';`
2. Wrap the entire content block (from "Top Ads by Reach" through the "+X more ads" text) with:
   ```tsx
   <FeatureGate feature="adPreviews">
     {/* existing content */}
   </FeatureGate>
   ```

The FeatureGate will:
- Show full grid for Pro users
- Show blurred teaser with upgrade CTA for free users
- Handle loading state automatically

Do NOT modify the AdPreviewCard component itself.
Do NOT change the grid layout or card styling.
  </action>
  <verify>
App compiles and runs: `npm run build`
Ad preview section visible in page source with FeatureGate wrapper.
  </verify>
  <done>
Ad preview grid is gated - Pro users see full grid, free users see locked teaser.
  </done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build`
2. FeatureGate component exists with correct exports
3. Ad preview section wrapped with FeatureGate in page.tsx
4. Visual check: Free user should see blurred ad preview section with lock overlay
5. Visual check: Pro user should see full ad preview grid
</verification>

<success_criteria>
- FeatureGate component is reusable for any feature in TierConfig['features']
- Ad preview section correctly gates based on tier
- Free users see compelling teaser that encourages upgrade
- Pro users see full ad preview grid unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/13-pro-features/13-01-SUMMARY.md`
</output>
