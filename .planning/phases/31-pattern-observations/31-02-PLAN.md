---
phase: 31-pattern-observations
plan: 02
type: execute
wave: 2
depends_on: ["31-01"]
files_modified:
  - src/app/dashboard/[brandId]/page.tsx
autonomous: false

must_haves:
  truths:
    - "User sees observation cards between brand header and metrics grid on brand detail page"
    - "Observation cards are ranked by signal magnitude (strongest pattern first)"
    - "Observations section is completely hidden when no significant patterns exist"
    - "Observations update when snapshot data changes (e.g., after re-analysis)"
  artifacts:
    - path: "src/app/dashboard/[brandId]/page.tsx"
      provides: "Integrated observation list between header and metrics"
      contains: "generateObservations"
  key_links:
    - from: "src/app/dashboard/[brandId]/page.tsx"
      to: "src/lib/observation-engine.ts"
      via: "import and call generateObservations"
      pattern: "generateObservations\\(snapshot.*hookGroups\\)"
    - from: "src/app/dashboard/[brandId]/page.tsx"
      to: "src/components/dashboard/observation-list.tsx"
      via: "renders ObservationList component"
      pattern: "<ObservationList"
---

<objective>
Integrate observation cards into the brand detail page so users see auto-generated pattern insights.

Purpose: Wire the observation engine and card components into the existing brand detail page, placing them between the brand header and metrics grid as the first thing a user sees about a brand's patterns.
Output: Modified brand detail page with observation cards visible when patterns are detected.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-pattern-observations/31-RESEARCH.md
@.planning/phases/31-pattern-observations/31-01-SUMMARY.md

@src/app/dashboard/[brandId]/page.tsx
@src/lib/observation-engine.ts
@src/components/dashboard/observation-list.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate observations into brand detail page</name>
  <files>src/app/dashboard/[brandId]/page.tsx</files>
  <action>
Modify `src/app/dashboard/[brandId]/page.tsx` to display observation cards:

1. Add imports at top of file:
   - `import { generateObservations } from '@/lib/observation-engine';`
   - `import { ObservationList } from '@/components/dashboard/observation-list';`

2. Add a `useMemo` hook inside the component (after existing state/memo declarations):
   ```typescript
   const observations = useMemo(() => {
     if (!snapshot) return [];
     return generateObservations(snapshot, hookGroups);
   }, [snapshot, hookGroups]);
   ```

3. Insert the ObservationList component in the JSX. It goes INSIDE the `snapshot` truthy branch (the `<div className="space-y-6">` block), BEFORE the metrics grid (`<div className="grid grid-cols-2 sm:grid-cols-4 gap-4">`). The exact insertion point is after line 227 (the opening `<div className="space-y-6">`) and before line 229 (the metrics grid).

   Add:
   ```tsx
   <ObservationList observations={observations} />
   ```

   This is a single line. The ObservationList component handles empty state internally (returns null when no observations).

4. Do NOT modify any other part of the page. Do not change the metrics grid, demographics sections, or hook explorer.
  </action>
  <verify>
Run `npx tsc --noEmit` â€” no type errors. Run `npm run build` to verify the page compiles. Start dev server with `npm run dev` and navigate to a brand detail page to confirm observations render (or are hidden if no patterns detected).
  </verify>
  <done>
Brand detail page imports and renders ObservationList. Observations appear between header and metrics when patterns are detected. Page is hidden/empty when no patterns exist.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Pattern observation cards integrated into the brand detail page. The system auto-generates factual observations from demographic data (age/gender skew, gender imbalance, geographic concentration) and hook data (recurring hooks). Up to 5 cards appear ranked by signal strength between the brand header and the metrics grid. Cards are hidden entirely when no significant patterns are detected.
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Navigate to a saved brand detail page (e.g., http://localhost:3000/dashboard/{brandId})
3. Check for "Key Observations" section between the brand header buttons and the metrics grid
4. Verify observation cards show relevant patterns:
   - Demographic Skew card (if dominant age >= 25%)
   - Gender Imbalance card (if one gender > 60%)
   - Geographic Concentration card (if top 2 countries > 50%)
   - Recurring Hook card (if top hook frequency >= 3 and brand has >= 5 ads)
5. Verify cards are sorted by signal strength (strongest pattern first)
6. If a brand has no significant patterns, confirm the observation section is completely absent (not an empty container)
7. Check visual styling: cards should look clean with icons, compact layout, and consistent with the page's dark theme
  </how-to-verify>
  <resume-signal>Type "approved" or describe any visual/functional issues to fix</resume-signal>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npm run build` succeeds
- Brand detail page shows observation cards when patterns exist
- Brand detail page hides observation section when no patterns exist
- Cards are ranked by magnitude (strongest first)
- All four observation types can trigger (demographic skew, gender imbalance, geo concentration, hook pattern)
</verification>

<success_criteria>
User sees up to 5 observation cards at top of brand detail page ranked by signal magnitude. Observations are hidden entirely when no significant patterns are detected. All four observation types (OBSV-01 through OBSV-04) generate correctly based on threshold rules.
</success_criteria>

<output>
After completion, create `.planning/phases/31-pattern-observations/31-02-SUMMARY.md`
</output>
