---
phase: 04-display
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/components/demographics/demographics-summary.tsx
  - src/components/demographics/age-gender-chart.tsx
  - src/components/demographics/country-chart.tsx
autonomous: true

must_haves:
  truths:
    - "User can see text summary of dominant gender and age range"
    - "User can see age/gender breakdown as stacked bar chart"
    - "User can see country distribution as pie chart"
  artifacts:
    - path: "src/components/demographics/demographics-summary.tsx"
      provides: "Text summary of demographics"
      exports: ["DemographicsSummary"]
    - path: "src/components/demographics/age-gender-chart.tsx"
      provides: "Stacked bar chart for age/gender"
      exports: ["AgeGenderChart"]
    - path: "src/components/demographics/country-chart.tsx"
      provides: "Pie chart for country distribution"
      exports: ["CountryChart"]
  key_links:
    - from: "src/components/demographics/age-gender-chart.tsx"
      to: "recharts"
      via: "import { ResponsiveContainer, BarChart, ... }"
      pattern: "from 'recharts'"
    - from: "src/components/demographics/country-chart.tsx"
      to: "recharts"
      via: "import { ResponsiveContainer, PieChart, ... }"
      pattern: "from 'recharts'"
---

<objective>
Create three demographics display components: text summary, age/gender bar chart, and country pie chart.

Purpose: Visualize aggregated demographic data in user-friendly formats - text for quick insights, charts for detailed breakdowns.
Output: Three ready-to-use React components that consume AggregatedDemographics data.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-display/04-RESEARCH.md

Type definitions:
@src/lib/demographic-types.ts

Styling patterns:
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DemographicsSummary component</name>
  <files>src/components/demographics/demographics-summary.tsx</files>
  <action>
Create text summary component that displays key demographic insights.

Requirements:
- Import AggregatedDemographics from '@/lib/demographic-types'
- Calculate dominant gender from genderBreakdown array (highest percentage)
- Calculate combined 25-44 age range percentage from ageBreakdown
- Display in format: "X% female" and "Y% ages 25-44"
- Show metadata: "Based on N ads analyzed"
- Use existing text color variables: var(--text-primary), var(--text-muted)

Component structure:
```typescript
'use client';

import { AggregatedDemographics } from '@/lib/demographic-types';

interface DemographicsSummaryProps {
  demographics: AggregatedDemographics;
}

export function DemographicsSummary({ demographics }: DemographicsSummaryProps) {
  // Find dominant gender (highest percentage)
  const dominantGender = demographics.genderBreakdown
    .reduce((max, curr) => curr.percentage > max.percentage ? curr : max);

  // Combine 25-34 and 35-44 age ranges
  const youngAdults = demographics.ageBreakdown
    .filter(a => a.age === '25-34' || a.age === '35-44')
    .reduce((sum, a) => sum + a.percentage, 0);

  return (
    <div className="space-y-2">
      <p className="text-lg text-[var(--text-primary)]">
        <span className="font-bold">{Math.round(dominantGender.percentage)}%</span>
        {' '}{dominantGender.gender}
      </p>
      <p className="text-lg text-[var(--text-primary)]">
        <span className="font-bold">{Math.round(youngAdults)}%</span>
        {' '}ages 25-44
      </p>
      <p className="text-sm text-[var(--text-muted)]">
        Based on {demographics.adsWithDemographics} ads analyzed
      </p>
    </div>
  );
}
```
  </action>
  <verify>
- File exists at src/components/demographics/demographics-summary.tsx
- `npx tsc --noEmit` passes
- Component exports `DemographicsSummary`
  </verify>
  <done>DemographicsSummary displays dominant gender %, combined 25-44 age %, and ads count</done>
</task>

<task type="auto">
  <name>Task 2: Create AgeGenderChart component</name>
  <files>src/components/demographics/age-gender-chart.tsx</files>
  <action>
Create stacked bar chart showing age/gender breakdown using Recharts.

Requirements:
- Accept ageGenderBreakdown array from AggregatedDemographics
- Transform data to grouped format: { age: string, male: number, female: number, unknown?: number }
- Use ResponsiveContainer with parent div having explicit height (300px)
- Stacked bars: female (pink #ec4899), male (blue #3b82f6), unknown (gray #6b7280)
- Include XAxis (age), YAxis (percentage), Tooltip, Legend
- Tooltip should format values as percentages

Component structure:
```typescript
'use client';

import { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, Legend } from 'recharts';

interface AgeGenderChartProps {
  data: { age: string; gender: string; percentage: number }[];
}

export function AgeGenderChart({ data }: AgeGenderChartProps) {
  // Transform to grouped format for stacked bar chart
  const groupedData = data.reduce((acc, item) => {
    const existing = acc.find(d => d.age === item.age);
    if (existing) {
      existing[item.gender] = item.percentage;
    } else {
      acc.push({ age: item.age, [item.gender]: item.percentage });
    }
    return acc;
  }, [] as Record<string, number | string>[]);

  return (
    <div style={{ width: '100%', height: 300 }}>
      <ResponsiveContainer>
        <BarChart data={groupedData}>
          <XAxis dataKey="age" tick={{ fontSize: 12 }} />
          <YAxis domain={[0, 'auto']} tick={{ fontSize: 12 }} />
          <Tooltip formatter={(value: number) => `${value.toFixed(1)}%`} />
          <Legend />
          <Bar dataKey="female" fill="#ec4899" name="Female" stackId="stack" />
          <Bar dataKey="male" fill="#3b82f6" name="Male" stackId="stack" />
          <Bar dataKey="unknown" fill="#6b7280" name="Unknown" stackId="stack" />
        </BarChart>
      </ResponsiveContainer>
    </div>
  );
}
```
  </action>
  <verify>
- File exists at src/components/demographics/age-gender-chart.tsx
- `npx tsc --noEmit` passes
- Imports from 'recharts' resolve correctly
  </verify>
  <done>AgeGenderChart renders stacked bar chart with age groups on X-axis, gender breakdown as stacked bars</done>
</task>

<task type="auto">
  <name>Task 3: Create CountryChart component</name>
  <files>src/components/demographics/country-chart.tsx</files>
  <action>
Create pie chart showing country/region distribution using Recharts.

Requirements:
- Accept regionBreakdown array from AggregatedDemographics
- Show top 5 countries, group rest as "Other"
- Use ResponsiveContainer with parent div having explicit height (300px)
- Use green color palette matching design system: #1a3933, #2d5a4f, #3d7a6f, #4d9a8f, #5dbaa0, #6ddab0
- Include labels showing "Country: X.X%"
- Include Tooltip for hover details

Component structure:
```typescript
'use client';

import { ResponsiveContainer, PieChart, Pie, Cell, Tooltip } from 'recharts';

const COLORS = ['#1a3933', '#2d5a4f', '#3d7a6f', '#4d9a8f', '#5dbaa0', '#6ddab0'];

interface CountryChartProps {
  data: { region: string; percentage: number }[];
}

export function CountryChart({ data }: CountryChartProps) {
  // Take top 5 countries, group rest as "Other"
  const sortedData = [...data].sort((a, b) => b.percentage - a.percentage);
  const topCountries = sortedData.slice(0, 5);
  const otherPercentage = sortedData.slice(5).reduce((sum, c) => sum + c.percentage, 0);

  const chartData = [
    ...topCountries.map(c => ({ name: c.region, value: c.percentage })),
    ...(otherPercentage > 0 ? [{ name: 'Other', value: otherPercentage }] : [])
  ];

  return (
    <div style={{ width: '100%', height: 300 }}>
      <ResponsiveContainer>
        <PieChart>
          <Pie
            data={chartData}
            dataKey="value"
            nameKey="name"
            cx="50%"
            cy="50%"
            outerRadius={100}
            label={({ name, value }) => `${name}: ${value.toFixed(1)}%`}
          >
            {chartData.map((_, index) => (
              <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
            ))}
          </Pie>
          <Tooltip formatter={(value: number) => `${value.toFixed(1)}%`} />
        </PieChart>
      </ResponsiveContainer>
    </div>
  );
}
```
  </action>
  <verify>
- File exists at src/components/demographics/country-chart.tsx
- `npx tsc --noEmit` passes
- Imports from 'recharts' resolve correctly
  </verify>
  <done>CountryChart renders pie chart with top 5 countries plus "Other", using green color palette</done>
</task>

</tasks>

<verification>
All three component files exist in src/components/demographics/:
- demographics-summary.tsx
- age-gender-chart.tsx
- country-chart.tsx

`npx tsc --noEmit` passes with no type errors.
</verification>

<success_criteria>
1. DemographicsSummary shows dominant gender % and combined 25-44 age %
2. AgeGenderChart renders stacked bar chart with age on X-axis
3. CountryChart renders pie chart with top 5 countries + Other
4. All components use Recharts ResponsiveContainer with explicit parent height
5. TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-display/04-02-SUMMARY.md`
</output>
