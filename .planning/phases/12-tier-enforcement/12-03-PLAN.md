---
phase: 12-tier-enforcement
plan: 03
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - src/components/tier/pro-badge.tsx
  - src/components/tier/depth-selector.tsx
  - src/app/page.tsx
autonomous: true

must_haves:
  truths:
    - "Free user sees Pro badge on locked depth options (500, 1000)"
    - "Pro user can select 100, 500, or 1000 depth"
    - "Clicking locked option shows upgrade prompt"
    - "Selected depth respects tier limits"
  artifacts:
    - path: "src/components/tier/pro-badge.tsx"
      provides: "Pro badge component"
      exports: ["ProBadge"]
    - path: "src/components/tier/depth-selector.tsx"
      provides: "Tier-aware depth selector"
      exports: ["DepthSelector"]
    - path: "src/app/page.tsx"
      provides: "Updated page with tier-aware depth selector"
      contains: "DepthSelector"
  key_links:
    - from: "src/components/tier/depth-selector.tsx"
      to: "src/hooks/use-tier-access.ts"
      via: "imports useTierAccess hook"
      pattern: "import.*useTierAccess"
    - from: "src/components/tier/depth-selector.tsx"
      to: "src/components/tier/pro-badge.tsx"
      via: "imports ProBadge"
      pattern: "import.*ProBadge"
    - from: "src/app/page.tsx"
      to: "src/components/tier/depth-selector.tsx"
      via: "imports DepthSelector"
      pattern: "import.*DepthSelector"
---

<objective>
Create tier UI components and integrate into the main page.

Purpose: Show users their tier limits with clear upgrade path for locked features.
Output: ProBadge component, tier-aware DepthSelector, updated page.tsx.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-tier-enforcement/12-RESEARCH.md
@.planning/phases/12-tier-enforcement/12-01-SUMMARY.md
@src/app/page.tsx
@src/hooks/use-tier-access.ts
@src/components/subscription/upgrade-button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProBadge component</name>
  <files>src/components/tier/pro-badge.tsx</files>
  <action>
Create the Pro badge component:

```typescript
// src/components/tier/pro-badge.tsx
'use client';

interface ProBadgeProps {
  className?: string;
  size?: 'sm' | 'md';
}

export function ProBadge({ className = '', size = 'sm' }: ProBadgeProps) {
  const sizeClasses = {
    sm: 'text-[10px] px-1.5 py-0.5',
    md: 'text-xs px-2 py-0.5',
  };

  return (
    <span
      className={`inline-flex items-center rounded-full bg-gradient-to-r from-blue-500 to-purple-500 text-white font-medium ${sizeClasses[size]} ${className}`}
    >
      Pro
    </span>
  );
}
```

Follow project styling conventions:
- Match existing badge patterns (see subscription-status.tsx)
- Use gradient for premium feel
- Small by default to fit inline with depth buttons
  </action>
  <verify>Create file and run `npx tsc --noEmit` - no errors</verify>
  <done>ProBadge component exists with sm/md sizes and gradient styling</done>
</task>

<task type="auto">
  <name>Task 2: Create tier-aware DepthSelector</name>
  <files>src/components/tier/depth-selector.tsx</files>
  <action>
Create depth selector that shows locked options with Pro badges:

```typescript
// src/components/tier/depth-selector.tsx
'use client';

import { useTierAccess } from '@/hooks/use-tier-access';
import { ProBadge } from './pro-badge';
import { createCheckoutSession } from '@/app/actions/stripe';
import { useTransition } from 'react';
import { useSession } from 'next-auth/react';
import { signIn } from 'next-auth/react';

interface DepthSelectorProps {
  value: number;
  onChange: (depth: number) => void;
  disabled?: boolean;
}

const DEPTH_OPTIONS = [
  { depth: 100, label: '100', tier: 'free' as const },
  { depth: 500, label: '500', tier: 'pro' as const },
  { depth: 1000, label: '1K', tier: 'pro' as const },
] as const;

export function DepthSelector({ value, onChange, disabled }: DepthSelectorProps) {
  const { canUseDepth, isPro, isLoading } = useTierAccess();
  const { data: session } = useSession();
  const [isPending, startTransition] = useTransition();

  const handleLockedClick = (depth: number) => {
    // If not logged in, redirect to sign in
    if (!session) {
      signIn();
      return;
    }
    // If logged in but free tier, start checkout
    startTransition(() => createCheckoutSession());
  };

  return (
    <div className="flex rounded-lg bg-[var(--bg-tertiary)] p-1 border border-[var(--border-subtle)]">
      {DEPTH_OPTIONS.map((option) => {
        const isLocked = !canUseDepth(option.depth);
        const isSelected = value === option.depth;

        return (
          <button
            key={option.depth}
            type="button"
            onClick={() => {
              if (isLocked) {
                handleLockedClick(option.depth);
              } else {
                onChange(option.depth);
              }
            }}
            disabled={disabled || isLoading || isPending}
            className={`relative px-2.5 py-1.5 text-xs font-medium rounded-md transition-colors flex items-center gap-1 ${
              isSelected
                ? 'bg-[var(--accent-green)] text-white'
                : isLocked
                  ? 'bg-[var(--bg-elevated)] text-[var(--text-muted)] hover:bg-[var(--border-subtle)]'
                  : 'bg-[var(--bg-elevated)] text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--border-subtle)]'
            }`}
          >
            {option.label}
            {isLocked && <ProBadge size="sm" />}
          </button>
        );
      })}
    </div>
  );
}
```

Key features:
- Uses useTierAccess hook to check permissions
- Shows ProBadge on locked options
- Clicking locked option starts checkout (or sign in if not logged in)
- Uses useTransition for loading state during checkout
- Matches existing button styling from page.tsx
  </action>
  <verify>Run `npx tsc --noEmit` - no type errors</verify>
  <done>DepthSelector shows 100/500/1K options with Pro badges on locked items, triggers checkout on click</done>
</task>

<task type="auto">
  <name>Task 3: Integrate DepthSelector into page.tsx</name>
  <files>src/app/page.tsx</files>
  <action>
Replace the existing depth selector in page.tsx with the new tier-aware component:

1. Add import near top (with other component imports):
```typescript
import { DepthSelector } from '@/components/tier/depth-selector';
```

2. Simplify analysisLimit state type to match new options:
```typescript
// Change from:
const [analysisLimit, setAnalysisLimit] = useState<100 | 250 | 500 | 1000>(100);
// To:
const [analysisLimit, setAnalysisLimit] = useState<number>(100);
```

3. Remove the PRICING_TIERS constant and PricingModal component (no longer needed - checkout handles upgrade)

4. Remove pricing modal state:
```typescript
// DELETE these:
const [showPricingModal, setShowPricingModal] = useState(false);
const [selectedPricingTier, setSelectedPricingTier] = useState<250 | 500 | 1000 | 'enterprise' | null>(null);
```

5. Delete the PricingModal component definition (lines ~105-201)

6. Delete the pricing modal render at top of return:
```typescript
// DELETE this block:
{showPricingModal && selectedPricingTier && (
  <PricingModal
    tier={selectedPricingTier}
    onClose={() => {
      setShowPricingModal(false);
      setSelectedPricingTier(null);
    }}
  />
)}
```

7. Replace the depth selector section in the Options div (around line 535-581). Find this block:
```typescript
<span className="text-xs text-[var(--text-muted)]">Depth:</span>
<div className="flex rounded-lg bg-[var(--bg-tertiary)] p-1 border border-[var(--border-subtle)]">
  {([100, 250, 500, 1000] as const).map((limit) => {
    // ... old depth buttons with pricing
  })}
  <button ... Enterprise button ...>
  </button>
</div>
```

Replace with:
```typescript
<span className="text-xs text-[var(--text-muted)]">Depth:</span>
<DepthSelector
  value={analysisLimit}
  onChange={setAnalysisLimit}
  disabled={isLoadingAds}
/>
```

This removes ~50 lines of pricing button code and replaces with clean component.
  </action>
  <verify>
1. `npm run build` succeeds
2. Visit http://localhost:3000 - depth selector shows 100/500/1K options
3. When logged out, 500 and 1K show Pro badges
4. Clicking locked option redirects to sign in
5. When logged in as free user, clicking locked option starts Stripe checkout
  </verify>
  <done>page.tsx uses new DepthSelector, PricingModal removed, depth options are tier-gated</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` succeeds
- [ ] ProBadge component renders gradient badge
- [ ] DepthSelector shows Pro badges on 500/1K for free users
- [ ] Clicking locked depth triggers checkout (or sign in)
- [ ] PricingModal and PRICING_TIERS removed from page.tsx
</verification>

<success_criteria>
- Free user sees 100 available, 500/1K locked with Pro badges
- Pro user sees all options (100/500/1K) available
- Clicking locked option starts upgrade flow
- UI matches existing styling conventions
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/12-tier-enforcement/12-03-SUMMARY.md`
</output>
