---
phase: 17.1-export-filter-fix
plan: 01
subsystem: ui
tags: [pdf-export, chart-filter, tooltip, responsive, tailwind]

# Dependency graph
requires:
  - phase: 16-02
    provides: "Multi-tab PDF export with isExporting state and onProgress callback"
  - phase: 15-02
    provides: "Chart click-to-filter with chartFilter state and filteredAds useMemo"
  - phase: 17-02
    provides: "Responsive country chart labels (w-20 sm:w-36)"
provides:
  - "Unfiltered PDF ad table regardless of active chart filter"
  - "Mobile-visible export progress on button element"
  - "Responsive tooltip positioning matching label column widths"
affects: [17.2-dashboard-cleanup]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Conditional data source: isExporting ? fullData : filteredData for export correctness"
    - "Responsive Tailwind positioning: left-20 sm:left-36 matching column widths"

key-files:
  created: []
  modified:
    - src/app/page.tsx
    - src/components/demographics/country-chart.tsx

key-decisions:
  - "No new patterns - all fixes use existing state variables and Tailwind responsive classes"

patterns-established:
  - "Export data source pattern: always use unfiltered data during isExporting to avoid filter leakage into PDF"

# Metrics
duration: 1min
completed: 2026-02-01
---

# Phase 17.1 Plan 01: Export & Filter Fix Summary

**Unfiltered PDF ad table via conditional data source, mobile export progress on button, and responsive tooltip positioning for 375px viewports**

## Performance

- **Duration:** ~1 min
- **Started:** 2026-02-01T10:23:50Z
- **Completed:** 2026-02-01T10:24:48Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments
- PDF export now renders all ads regardless of active chart filter (uses apiResult.ads when isExporting)
- Export button shows progress step text on mobile where dropdown is not always visible
- Country chart tooltip no longer overflows on 375px viewports (left-20 on mobile, left-36 on sm+)

## Task Commits

Each task was committed atomically:

1. **Task 1: Use unfiltered ads in PDF export and show mobile progress** - `74f37ac` (fix)
2. **Task 2: Fix country chart tooltip positioning for narrow viewports** - `b41e313` (fix)

## Files Created/Modified
- `src/app/page.tsx` - Conditional ad data source during export; "(showing N)" hidden during export; progress text on Export button
- `src/components/demographics/country-chart.tsx` - Responsive tooltip left offset matching label column width

## Decisions Made
None - followed plan as specified.

## Deviations from Plan
None - plan executed exactly as written.

## Issues Encountered
None.

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- All three v2.1 audit gaps from 17.1 are closed
- Ready for phase 17.2 (dashboard cleanup) if planned

---
*Phase: 17.1-export-filter-fix*
*Completed: 2026-02-01*
